<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YETI Kelime Oyunu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            background-color: var(--theme-primary);
            color: var(--theme-text);
        }
        .hidden { display: none; }
        
        .player-slot.active {
            border-color: #818cf8;
            --scale: 1.15;
            box-shadow: 0 0 25px #818cf8;
            z-index: 20;
        }
        .player-slot.eliminated {
            opacity: 0.4;
            background-color: #374151;
            border-color: #1f2937;
            --scale: 0.95;
        }
        @keyframes pulse-white-to-red {
            0% { color: #ffffff; }
            100% { color: #dc2626; transform: scale(1.1); }
        }
        .animate-pulse-white-to-red {
            animation: pulse-white-to-red 1s ease-out forwards;
        }
        .gold { background-image: linear-gradient(to right, #fde047, #eab308); color: #422006; border-color: #fde047 !important;}
        .silver { background-image: linear-gradient(to right, #e5e7eb, #a1a1aa); color: #1f2937; border-color: #e5e7eb !important;}

        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: var(--theme-primary);
        }
        
        /* TEMA Sƒ∞STEMƒ∞ */
        :root {
            --theme-primary: #1f2937;
            --theme-secondary: #374151;
            --theme-accent: #6366f1;
            --theme-accent-hover: #4f46e5;
            --theme-text: #ffffff;
            --theme-text-muted: #9ca3af;
            --theme-border: #4b5563;
            --theme-bg-overlay: rgba(31, 41, 55, 0.9);
            --theme-glow: rgba(99, 102, 241, 0.4);
        }

        .theme-void {
            --theme-primary: #0c0c0c;
            --theme-secondary: #1a1a1a;
            --theme-accent: #8b5cf6;
            --theme-accent-hover: #7c3aed;
            --theme-text: #e5e7eb;
            --theme-text-muted: #6b7280;
            --theme-border: #262626;
            --theme-bg-overlay: rgba(12, 12, 12, 0.95);
            --theme-glow: rgba(139, 92, 246, 0.5);
        }

        .theme-dark {
            --theme-primary: #1f2937;
            --theme-secondary: #374151;
            --theme-accent: #3b82f6;
            --theme-accent-hover: #2563eb;
            --theme-text: #f9fafb;
            --theme-text-muted: #9ca3af;
            --theme-border: #4b5563;
            --theme-bg-overlay: rgba(31, 41, 55, 0.9);
            --theme-glow: rgba(59, 130, 246, 0.4);
        }

        .theme-light {
            --theme-primary: #ffffff;
            --theme-secondary: #f8f9fa;
            --theme-accent: #0f172a;
            --theme-accent-hover: #1e293b;
            --theme-text: #1e293b;
            --theme-text-muted: #64748b;
            --theme-border: #cbd5e1;
            --theme-bg-overlay: rgba(255, 255, 255, 0.95);
            --theme-glow: rgba(15, 23, 42, 0.2);
        }

        /* HAREKETLI ARKA PLANLAR */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: var(--theme-primary);
        }

        .theme-void .animated-bg {
            background: linear-gradient(45deg, #0c0c0c 0%, #1a1a1a 50%, #0c0c0c 100%);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(139, 92, 246, 0.05) 0%, transparent 50%);
            background-size: 200% 200%, 300% 300%, 400% 400%;
            animation: voidFloat 20s ease-in-out infinite, voidPulse 15s ease-in-out infinite;
        }

        .theme-dark .animated-bg {
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #1f2937 100%);
            background-image: 
                radial-gradient(circle at 25px 25px, #334155 2px, transparent 2px),
                radial-gradient(circle at 75px 75px, #475569 1px, transparent 1px);
            background-size: 100px 100px, 150px 150px;
            animation: darkFloat 25s linear infinite;
        }

        .theme-light .animated-bg {
            background: #ffffff;
            background-image: 
                radial-gradient(circle at 30% 20%, rgba(15, 23, 42, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 70% 80%, rgba(15, 23, 42, 0.05) 0%, transparent 40%);
            background-size: 400px 400px, 600px 600px;
            animation: lightFloat 30s ease-in-out infinite;
        }

        @keyframes voidFloat {
            0%, 100% { background-position: 0% 0%, 100% 100%, 50% 50%; }
            33% { background-position: 100% 50%, 0% 0%, 100% 0%; }
            66% { background-position: 50% 100%, 50% 50%, 0% 100%; }
        }

        @keyframes voidPulse {
            0%, 100% { background-size: 200% 200%, 300% 300%, 400% 400%; }
            50% { background-size: 250% 250%, 350% 350%, 450% 450%; }
        }

        @keyframes darkFloat {
            0% { background-position: 0 0, 50px 50px; }
            100% { background-position: 100px 100px, 150px 150px; }
        }

        @keyframes lightFloat {
            0%, 100% { background-position: 0% 0%, 100% 100%; }
            50% { background-position: 100% 100%, 0% 0%; }
        }

        /* TEMA BUTONLARI */
        .bg-controls {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            align-items: center;
            pointer-events: auto;
        }

        .theme-selector {
            display: flex;
            gap: 8px;
        }

        .bg-btn {
            background: rgba(0,0,0,0.35);
            color: var(--theme-text);
            border: 1px solid rgba(255,255,255,0.06);
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.18s ease;
        }
        .bg-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.35); }

        .home-btn { display: none; }
        .home-btn.show { display: inline-flex; align-items: center; }

        .theme-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            line-height: 1;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .theme-btn:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .theme-btn.active {
            border-color: #fbbf24;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.6);
        }

        .theme-btn-void {
            background-color: #0b1220; /* solid dark */
            color: #e6eef8;
            font-size: 18px;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .theme-btn-dark {
            background-color: #2d3748; /* solid slate */
            color: #f1f5f9;
            font-size: 18px;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .theme-btn-light {
            background-color: #ffffff; /* solid white */
            color: #0f172a;
            font-size: 18px;
            border: 1px solid #e6eef8;
            box-shadow: 0 2px 6px rgba(2,6,23,0.06);
        }
        
        .theme-btn::before {
            display: none;
        }
        
        @media (max-width: 768px) {
            .bg-controls { top: 10px; right: 10px; flex-direction: row; flex-wrap: wrap; max-width: 200px; }
            .bg-btn { padding: 6px 12px; font-size: 10px; flex: 1; min-width: 60px; }
        }

        #howto-panel {
            position: fixed;
            top: 76px;
            right: 20px;
            width: 320px;
            max-width: calc(100% - 40px);
            z-index: 1100;
            background: rgba(17,24,39,0.95);
            border: 1px solid rgba(255,255,255,0.04);
            padding: 14px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.6);
        }
        #howto-panel .close-howto { position: absolute; top: 8px; right: 8px; background: transparent; border: none; color: #c7d2fe; font-weight: 700; cursor: pointer; }
        
        .avatar { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); border: 3px solid transparent; transition: all 0.3s ease; margin-bottom: 8px; }
        .avatar.small { width: 40px; height: 40px; font-size: 16px; margin-bottom: 4px; }
        .avatar.large { width: 80px; height: 80px; font-size: 32px; margin-bottom: 12px; }
        
        .avatar-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; align-items: center; justify-content: center; z-index: 2000; -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); }
        .avatar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; max-width: 400px; padding: 20px; }
        .avatar-option { cursor: pointer; transition: all 0.3s ease; border: 3px solid transparent; }
        .avatar-option:hover { transform: scale(1.1); border-color: #60a5fa; box-shadow: 0 0 20px rgba(96, 165, 250, 0.5); }
        .avatar-option.selected { border-color: #fbbf24; box-shadow: 0 0 25px rgba(251, 191, 36, 0.8); }

        .avatar-1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .avatar-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .avatar-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .avatar-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .avatar-5 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .avatar-6 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .avatar-7 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .avatar-8 { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        .avatar-9 { background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%); }
        .avatar-10 { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
        .avatar-11 { background: linear-gradient(135deg, #cfd9df 0%, #e2ebf0 100%); }
        .avatar-12 { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); }
        .avatar-13 { background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%); }
        .avatar-14 { background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%); }
        .avatar-15 { background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); }
        .avatar-16 { background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%); }
        
        .slot-container { 
            height: 60px; 
            overflow: hidden; 
            position: relative; 
            border-radius: 0.75rem; 
            background-color: var(--theme-secondary); 
            border: 2px solid var(--theme-border); 
        }
        .slot-reel { 
            position: absolute; 
            top: 0; 
            left: 50%; 
            transform: translateX(-50%); 
            white-space: nowrap; 
            transition: top 2.5s cubic-bezier(0.25, 1, 0.5, 1); 
        }
        .slot-item { 
            height: 60px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 900; 
            background-color: var(--theme-secondary); 
            backface-visibility: hidden; 
            padding: 0 10px; 
            font-size: 2rem; 
            line-height: 1; 
            color: var(--theme-text);
        }
        
        .game-title { background: linear-gradient( 90deg, #a5b4fc, #6366f1, #a5b4fc ); background-size: 200% auto; color: transparent; -webkit-background-clip: text; background-clip: text; animation: modern-shine 4s linear infinite; }
        @keyframes modern-shine { 0% { background-position: 200% center; } 100% { background-position: -200% center; } }

        /* YENƒ∞ OYUN LOBƒ∞Sƒ∞ STƒ∞LLERƒ∞ */
        #center-game-panel { position: relative; width: 100%; max-width: 700px; margin: auto; aspect-ratio: 1 / 1; }
        #center-task-area { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; width: 260px; }
        #circular-player-container { position: relative; width: 100%; height: 100%; }
        
        @keyframes contentFloat {
            0%, 100% { transform: translate(0, 0); }
            20% { transform: translate(var(--float-x1), var(--float-y1)); }
            40% { transform: translate(var(--float-x2), var(--float-y2)); }
            60% { transform: translate(var(--float-x3), var(--float-y3)); }
            80% { transform: translate(var(--float-x4), var(--float-y4)); }
            100% { transform: translate(0, 0); }
        }

        .player-slot-circle {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--theme-secondary);
            background-image: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0) 50%), radial-gradient(circle at 70% 70%, rgba(0,0,0,0.06) 0%, rgba(0,0,0,0) 50%);
            background-size: cover;
            border: 2px solid var(--theme-border);
            box-shadow: 0 0 15px var(--theme-glow), inset 0 0 8px rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease-out;
            transform: translate(-50%, -50%) scale(var(--scale, 1));
            animation: slotFloat 4s ease-in-out infinite;
            animation-delay: var(--delay, 0s);
        }
        .player-slot-circle.active {
            border-color: var(--theme-accent);
            box-shadow: 0 0 25px var(--theme-glow), inset 0 0 15px rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%) scale(1.15);
            z-index: 20;
            animation: none;
        }

        /* AVATAR BASED GLOW COLORS */
        .player-slot-circle[data-avatar="1"] { 
            box-shadow: 0 0 15px rgba(139, 69, 19, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="1"].active { 
            box-shadow: 0 0 30px rgba(139, 69, 19, 0.8), 0 0 50px rgba(139, 69, 19, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="2"] { 
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="2"].active { 
            box-shadow: 0 0 30px rgba(220, 20, 60, 0.8), 0 0 50px rgba(220, 20, 60, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="3"] { 
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="3"].active { 
            box-shadow: 0 0 30px rgba(255, 140, 0, 0.8), 0 0 50px rgba(255, 140, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="4"] { 
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="4"].active { 
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="5"] { 
            box-shadow: 0 0 15px rgba(154, 205, 50, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="5"].active { 
            box-shadow: 0 0 30px rgba(154, 205, 50, 0.8), 0 0 50px rgba(154, 205, 50, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="6"] { 
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="6"].active { 
            box-shadow: 0 0 30px rgba(0, 255, 127, 0.8), 0 0 50px rgba(0, 255, 127, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="7"] { 
            box-shadow: 0 0 15px rgba(64, 224, 208, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="7"].active { 
            box-shadow: 0 0 30px rgba(64, 224, 208, 0.8), 0 0 50px rgba(64, 224, 208, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="8"] { 
            box-shadow: 0 0 15px rgba(135, 206, 235, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="8"].active { 
            box-shadow: 0 0 30px rgba(135, 206, 235, 0.8), 0 0 50px rgba(135, 206, 235, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="9"] { 
            box-shadow: 0 0 15px rgba(70, 130, 180, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="9"].active { 
            box-shadow: 0 0 30px rgba(70, 130, 180, 0.8), 0 0 50px rgba(70, 130, 180, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="10"] { 
            box-shadow: 0 0 15px rgba(147, 112, 219, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="10"].active { 
            box-shadow: 0 0 30px rgba(147, 112, 219, 0.8), 0 0 50px rgba(147, 112, 219, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="11"] { 
            box-shadow: 0 0 15px rgba(186, 85, 211, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="11"].active { 
            box-shadow: 0 0 30px rgba(186, 85, 211, 0.8), 0 0 50px rgba(186, 85, 211, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="12"] { 
            box-shadow: 0 0 15px rgba(255, 20, 147, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="12"].active { 
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.8), 0 0 50px rgba(255, 20, 147, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="13"] { 
            box-shadow: 0 0 15px rgba(255, 69, 0, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="13"].active { 
            box-shadow: 0 0 30px rgba(255, 69, 0, 0.8), 0 0 50px rgba(255, 69, 0, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="14"] { 
            box-shadow: 0 0 15px rgba(255, 99, 71, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="14"].active { 
            box-shadow: 0 0 30px rgba(255, 99, 71, 0.8), 0 0 50px rgba(255, 99, 71, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="15"] { 
            box-shadow: 0 0 15px rgba(255, 192, 203, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="15"].active { 
            box-shadow: 0 0 30px rgba(255, 192, 203, 0.8), 0 0 50px rgba(255, 192, 203, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle[data-avatar="16"] { 
            box-shadow: 0 0 15px rgba(173, 216, 230, 0.6), inset 0 0 8px rgba(255, 255, 255, 0.05);
        }
        .player-slot-circle[data-avatar="16"].active { 
            box-shadow: 0 0 30px rgba(173, 216, 230, 0.8), 0 0 50px rgba(173, 216, 230, 0.4), inset 0 0 15px rgba(255, 255, 255, 0.3);
        }
        .player-slot-circle.eliminated {
            opacity: 0.5;
            filter: grayscale(80%);
            box-shadow: none;
            border-color: #4b5563;
            background-color: #374151;
            animation: none;
        }
        .player-slot-circle.is-hovering {
            animation: none;
        }

        /* S√úZ√úLME ANƒ∞MASYONU */
        @keyframes slotFloat {
            0%, 100% { transform: translate(-50%, -50%) translateY(0px) rotate(0deg); }
            25% { transform: translate(-50%, -50%) translateY(-3px) rotate(1deg); }
            50% { transform: translate(-50%, -50%) translateY(0px) rotate(-0.5deg); }
            75% { transform: translate(-50%, -50%) translateY(2px) rotate(0.3deg); }
        }

        .bubble-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
            transition: transform 0.2s ease-out;
            transform: translate(var(--push-x, 0px), var(--push-y, 0px));
            position: relative;
        }

        #turn-indicator { 
            position: absolute;
            left: 50%;
            top: 50%;
            width: 100%;
            height: 6px;
            margin-top: 80px; /* push below bubble and panel */
            background: linear-gradient(90deg, rgba(129, 140, 248, 0), #a5b4fc);
            transform: translate(-50%, 0) rotate(-90deg);
            transform-origin: center center;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1; /* below bubble and panel */
            opacity: 1;
            border-radius: 3px;
            box-shadow: 0 0 15px #a5b4fc;
        }
        #turn-indicator.visible { opacity: 1; }
        #turn-indicator.winner { background: linear-gradient(90deg, rgba(34, 197, 94, 0), #22c55e); box-shadow: 0 0 20px #22c55e; }

        /* BUTON STƒ∞LLERƒ∞ VE GLOW EFEKTƒ∞ */
        .game-button {
            background: linear-gradient(135deg, var(--theme-accent), var(--theme-accent-hover));
            border: 2px solid var(--theme-accent);
            color: var(--theme-text);
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px var(--theme-glow);
        }
        .game-button:hover {
            box-shadow: 0 0 25px var(--theme-glow), 0 0 35px var(--theme-glow);
            transform: translateY(-2px);
        }

        /* S√úRE G√ñSTERGESI */
        #countdown-wrapper { 
            margin-top: 8px; 
            height: 80px; 
            width: 180px; 
            margin-left: auto; 
            margin-right: auto; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background-color: var(--theme-secondary); 
            border: 2px solid var(--theme-border); 
            border-radius: 0.75rem; 
        }
        #countdown { 
            font-size: 4.5rem; 
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; 
            font-weight: 700; 
            color: #ffffff !important; /* Her zaman beyaz */
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5); 
        }
        #countdown.placeholder { 
            font-size: 2rem; 
            color: #9ca3af !important; /* Her zaman gri */
            font-weight: 900; 
        }
        #countdown.animate-pulse-white-to-red {
            color: #ef4444 !important; /* Sadece 0'da kƒ±rmƒ±zƒ± */
            animation: pulse 1s infinite;
        }

        /* PANEL STƒ∞LLERƒ∞ */
        .game-panel {
            background: var(--theme-bg-overlay);
            border: 1px solid var(--theme-border);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }

        /* TEMA STƒ∞LLERƒ∞ */
        .themed-title { color: var(--theme-accent); }
        .themed-text-muted { color: var(--theme-text-muted); }
        .themed-accent { color: var(--theme-accent); }
        .themed-bg-secondary { background: var(--theme-secondary); }
        .themed-input {
            background-color: var(--theme-secondary);
            color: var(--theme-text);
            border: 1px solid var(--theme-border);
        }
        .themed-input:focus {
            border-color: var(--theme-accent);
            box-shadow: 0 0 0 2px var(--theme-glow);
        }

        /* ANASAYFA BUTONU */
        .home-btn { display: none; }
        .home-btn.show { display: inline-flex; align-items: center; }

        /* POPUP STƒ∞LLERƒ∞ */
        .confirmation-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .popup-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }
        .popup-content {
            position: relative;
            background: var(--theme-bg-overlay);
            border: 2px solid var(--theme-border);
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            margin: 20px;
            text-align: center;
        }
        .popup-content h3 {
            color: var(--theme-accent);
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 16px;
        }
        .popup-content p {
            color: var(--theme-text);
            margin-bottom: 24px;
        }
        .popup-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        .confirm-btn, .cancel-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        .confirm-btn {
            background: #dc2626;
            color: white;
        }
        .confirm-btn:hover {
            background: #b91c1c;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }
        .cancel-btn {
            background: var(--theme-secondary);
            color: var(--theme-text);
            border: 1px solid var(--theme-border);
        }
        .cancel-btn:hover {
            background: var(--theme-accent);
            box-shadow: 0 0 15px var(--theme-glow);
        }

        /* AVATAR STƒ∞LLERƒ∞ */
        .avatar { 
            background-clip: padding-box !important;
            box-sizing: border-box;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-2">
    <div id="animated-background" class="animated-bg"></div>
    <div class="bg-controls" id="bg-controls-fixed">
        <div class="theme-selector">
            <div class="theme-btn theme-btn-void" onclick="changeTheme('void')" title="Void Theme">üåÄ</div>
            <div class="theme-btn theme-btn-dark active" onclick="changeTheme('dark')" title="Dark Theme">üåô</div>
            <div class="theme-btn theme-btn-light" onclick="changeTheme('light')" title="Light Theme">üîÜ</div>
        </div>
        <button class="bg-btn" id="toggle-howto">Nasƒ±l Oynanƒ±r</button>
        <button class="bg-btn home-btn" id="go-home" onclick="goToMainMenu()">üè† Anasayfa</button>
    </div>

    <div id="howto-panel" class="hidden" aria-hidden="true">
        <button class="close-howto" id="close-howto">‚úï</button>
        <h3 class="text-lg font-bold text-indigo-300 mb-2">Nasƒ±l Oynanƒ±r?</h3>
        <ul class="list-disc pl-5 text-sm text-gray-300">
            <li>Profil fotoƒürafƒ± ve kullanƒ±cƒ± adƒ± se√ßerek giri≈ü yapƒ±n.</li>
            <li>Oda olu≈üturabilir, odaya katƒ±labilir veya tek ba≈üƒ±nƒ±za oynayabilirsiniz.</li>
            <li>Her turda verilen harf ve kategoriye uygun kelimeyi hƒ±zlƒ±ca yazƒ±n veya s√∂yleyin.</li>
            <li>Hedef puana ula≈üan kazanƒ±r!</li>
        </ul>
    </div>

    <div id="avatar-modal" class="avatar-modal hidden">
        <div class="bg-gray-800/95 backdrop-blur-md rounded-3xl shadow-2xl border border-gray-700/50 p-8 max-w-md mx-4">
            <h3 class="text-2xl font-bold text-center mb-6 text-white">üé≠ Avatar Se√ß</h3>
            <div class="avatar-grid" id="avatar-grid"></div>
            <div class="flex gap-4 mt-6">
                <button id="avatar-confirm" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition">‚úÖ Se√ß</button>
                <button id="avatar-cancel" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition">‚ùå ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <div id="auth-screen" class="w-full max-w-md relative z-10">
        <div class="p-8 game-panel rounded-2xl shadow-2xl">
            <h1 class="text-3xl font-black mb-6 text-center game-title themed-title">YETI Kelime Oyunu</h1>
            <div class="mb-6 text-center">
                <p class="text-sm mb-3 themed-text-muted">Profil fotoƒürafƒ±nƒ± se√ß:</p>
                <div id="entry-avatar" class="avatar large avatar-1 mx-auto cursor-pointer hover:scale-110 transition-transform border-4 border-indigo-500" title="Profili deƒüi≈ütir">üéÆ</div>
            </div>
            <input id="entryUsername" type="text" placeholder="Kullanƒ±cƒ± adƒ±nƒ± gir" maxlength="20" class="w-full p-3 mb-4 rounded-lg text-center focus:outline-none focus:ring-2 themed-input">
            <button id="startGameButton" class="w-full game-button">üéÆ Oyuna Ba≈üla</button>
        </div>
        <div id="entryMessage" class="hidden mt-4 p-3 rounded-lg text-center text-sm"></div>
    </div>

    <div id="initial-screen" class="hidden w-full max-w-sm relative z-10">
        <div class="p-8 game-panel rounded-2xl shadow-2xl">
            <h1 class="text-3xl font-black mb-6 text-center game-title themed-title">YETI Kelime Oyunu</h1>
            <div id="join-options">
                <div class="mb-4 p-3 rounded-lg themed-bg-secondary">
                    <div class="flex items-center gap-3 mb-2">
                        <div id="user-avatar" class="avatar small avatar-1">üéÆ</div>
                        <div>
                            <p class="text-sm themed-text-muted">Ho≈ü geldin,</p>
                            <p class="font-bold themed-accent" id="welcomeUsername">Oyuncu</p>
                        </div>
                    </div>
                    <button id="choose-avatar-btn" class="w-full text-xs bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-3 rounded-lg transition">üé≠ Avatar Deƒüi≈ütir</button>
                    <button id="edit-username-btn" class="w-full text-xs bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-lg transition mt-2">‚úèÔ∏è ƒ∞sim Deƒüi≈ütir</button>
                </div>
                <button id="createRoomButton" class="w-full game-button mb-2">Oda Olu≈ütur</button>
                <button id="showJoinFormButton" class="w-full game-button mb-2">Odaya Katƒ±l</button>
                <button id="showStatsButton" class="w-full game-button mb-2">ÔøΩ ƒ∞statistiklerim</button>
            </div>
            <div id="join-form" class="hidden">
                <input id="roomInput" type="text" placeholder="Oda Kodunu Gir" maxlength="6" class="w-full p-3 mb-4 rounded-lg themed-input uppercase">
                <button id="joinRoomButton" class="w-full game-button">Katƒ±l</button>
                <button id="backToOptionsButton" class="w-full mt-2 text-gray-400 hover:text-white transition">Geri</button>
            </div>
        </div>
    </div>

    <div id="stats-screen" class="hidden w-full max-w-4xl relative z-10">
        <div class="p-8 game-panel rounded-2xl shadow-2xl">
            <h2 class="text-3xl font-bold text-center mb-6 text-yellow-400">üìä Oyuncu ƒ∞statistikleri</h2>
            <div id="stats-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="themed-bg-secondary p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 themed-accent">üéÆ Oyun ƒ∞statistikleri</h3>
                    <div class="space-y-2">
                        <p>Toplam Oyun: <span id="stat-games-played" class="font-bold">0</span></p>
                        <p>Kazanƒ±lan Oyun: <span id="stat-games-won" class="font-bold">0</span></p>
                        <p>Kazanma Oranƒ±: %<span id="stat-win-rate" class="font-bold">0</span></p>
                        <p>En Uzun Kazanma Serisi: <span id="stat-longest-streak" class="font-bold">0</span></p>
                        <p>Mevcut Kazanma Serisi: <span id="stat-current-streak" class="font-bold">0</span></p>
                        <p>Son Oyun: <span id="stat-last-played" class="font-bold">Hi√ß</span></p>
                    </div>
                </div>
                <div class="themed-bg-secondary p-6 rounded-lg">
                    <h3 class="text-xl font-bold mb-4 text-green-400">üìù Kelime ƒ∞statistikleri</h3>
                    <div class="space-y-2">
                        <p>Toplam Doƒüru Kelime: <span id="stat-total-words" class="font-bold">0</span></p>
                        <p>Ortalama Yanƒ±t S√ºresi: <span id="stat-avg-time" class="font-bold">0</span>sn</p>
                        <p>Favori Kategori: <span id="stat-fav-category" class="font-bold">Hen√ºz yok</span></p>
                    </div>
                </div>
                <div class="themed-bg-secondary p-6 rounded-lg md:col-span-2">
                    <h3 class="text-xl font-bold mb-4 text-orange-400">üî§ En √áok Kullanƒ±lan Kelimeler</h3>
                    <div id="most-used-words" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
                </div>
            </div>
            <div class="mt-6 text-center">
                <button id="closeStatsButton" class="game-button">Geri D√∂n</button>
            </div>
        </div>
    </div>
    
    <div id="game-container" class="hidden w-full max-w-screen-2xl mx-auto flex-col relative z-10 p-2">
        <div class="flex flex-col md:flex-row gap-4 w-full">
    
            <div id="left-panel" class="w-full md:w-1/5 p-4 game-panel rounded-2xl shadow-2xl flex flex-col">
                <h3 class="text-xl font-bold mb-4 text-center themed-title">T√ºm Ayarlar</h3>
                <div id="invite-link-ingame" class="mb-4">
                     <p class="text-sm themed-text-muted mb-2">Arkada≈ülarƒ±nƒ± Davet et:</p>
                     <div class="flex items-center space-x-2">
                        <input id="roomLinkInput" type="text" readonly class="w-full p-2 themed-input rounded-lg text-center font-mono select-all text-sm">
                        <button id="copyLinkButton" class="game-button text-sm p-2">Kopyala</button>
                     </div>
                </div>
                <div id="host-options" class="hidden space-y-4 mb-4">
                     <div>
                        <label for="scoreGoalSelect" class="block mb-2 text-sm themed-text-muted">Hedef Skoru Deƒüi≈ütir:</label>
                        <select id="scoreGoalSelect" class="w-full p-3 themed-input rounded-lg focus:outline-none focus:ring-2">
                            <option value="5">5 Puan</option>
                            <option value="10" selected>10 Puan</option>
                            <option value="15">15 Puan</option>
                            <option value="20">20 Puan</option>
                        </select>
                     </div>
                     <div>
                        <label for="turnDurationSelect" class="block mb-2 text-sm themed-text-muted">Tur S√ºresini Deƒüi≈ütir:</label>
                        <select id="turnDurationSelect" class="w-full p-3 themed-input rounded-lg focus:outline-none focus:ring-2">
                            <option value="5" selected>5 Saniye</option>
                            <option value="10">10 Saniye</option>
                            <option value="15">15 Saniye</option>
                        </select>
                     </div>
                </div>
                <div id="used-words-section" class="mt-auto flex-grow min-h-[150px]">
                    <h4 class="text-lg font-bold mb-2 text-center text-green-400">‚úÖ Son Kelimeler</h4>
                    <div id="used-words-list" class="themed-bg-secondary rounded-lg p-3 max-h-40 overflow-y-auto"></div>
                </div>
                <button id="saveSettingsButton" class="hidden w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition">KAYDET</button>
                <button id="resetScoreButton" class="hidden w-full mt-2 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition">SIFIRLA</button>
            </div>
    
            <div id="center-panel" class="w-full md:w-3/5 flex-grow flex flex-col justify-center items-center p-4 game-panel rounded-2xl shadow-2xl min-h-[600px]">
                <div id="center-game-panel">
                    <div id="center-task-area">
                         <div id="task-area" class="mb-4 p-4 themed-bg-secondary rounded-xl flex flex-col items-center gap-2">
                            <div id="letter-slot-container" class="slot-container w-full">
                                <div class="slot-reel"><div class="slot-item">HARF</div></div>
                            </div>
                            <div id="category-slot-container" class="slot-container w-full">
                                <div class="slot-reel"><div class="slot-item">KATEGORƒ∞</div></div>
                            </div>
                            <div id="countdown-wrapper">
                                <div id="countdown" class="placeholder">S√úRE</div>
                            </div>
                        </div>
                    </div>
                    <div id="circular-player-container" class="w-full h-full"></div>
                    <div id="turn-indicator"></div>
                </div>
                 <p id="status-text" class="text-lg themed-text-muted mt-4 h-8 flex items-center justify-center text-center"></p>
                 <div id="word-input-area" class="hidden mt-4">
                    <form id="word-form" class="flex justify-center space-x-2">
                        <input type="text" id="wordInput" placeholder="Kelimeyi buraya yazƒ±n..." class="w-full max-w-xs p-3 themed-input rounded-lg focus:outline-none focus:ring-2">
                        <button type="submit" id="sendWordButton" class="game-button">G√∂nder</button>
                    </form>
                </div>
                 <div id="host-decision-buttons" class="hidden space-x-4 h-14 mt-4">
                     <button id="addWordYes" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition text-xl">üëç Evet, Ekle</button>
                     <button id="addWordNo" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition text-xl">üëé Hayƒ±r</button>
                </div>
            </div>
    
            <div id="right-panel" class="w-full md:w-1/5 p-4 game-panel rounded-2xl shadow-2xl flex flex-col">
                <h3 class="text-xl font-bold mb-1 text-center themed-title">üèÜ Skor Tablosu</h3>
                <div class="text-center themed-bg-secondary py-2 px-4 rounded-lg mb-4 grid grid-cols-2 gap-4 text-sm">
                    <div>Hedef: <span id="score-goal-display" class="font-bold text-lg text-yellow-300">10</span></div>
                    <div>S√ºre: <span id="turn-duration-display" class="font-bold text-lg text-yellow-300">5</span>sn</div>
                </div>
                <div id="scoreboard" class="space-y-2 mt-4 flex-grow"></div>
                <div id="game-buttons" class="h-14 flex items-center justify-center space-x-4 mt-6">
                    <button id="startButton" class="hidden game-button">BA≈ûLAT</button>
                    <button id="newGameButton" class="hidden game-button">Yeni Oyun Ba≈ülat</button>
                </div>
                <div class="confirmation-popup hidden" id="reset-confirmation">
                    <div class="popup-overlay"></div>
                    <div class="popup-content">
                        <h3>Sƒ±fƒ±rlama Onayƒ±</h3>
                        <p>T√ºm skorlarƒ± sƒ±fƒ±rlamak istediƒüinizden emin misiniz?</p>
                        <div class="popup-buttons">
                            <button id="confirm-reset" class="confirm-btn">Evet, Sƒ±fƒ±rla</button>
                            <button id="cancel-reset" class="cancel-btn">ƒ∞ptal</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="single-player-container" class="hidden w-full max-w-2xl flex flex-col text-center relative z-10">
        <!-- TEK BA≈ûINA OYNA √ñZELLƒ∞ƒûƒ∞ KALDIRILDI -->
    </div>
    
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>

        window.goToMainMenu = function() {
            const gameContainer = document.getElementById('game-container');
            const singlePlayerContainer = document.getElementById('single-player-container');
            const statsScreen = document.getElementById('stats-screen');
            const initialScreen = document.getElementById('initial-screen');
            const authScreen = document.getElementById('auth-screen');
            const homeBtn = document.getElementById('go-home');
            
            if (gameContainer) gameContainer.classList.add('hidden');
            if (singlePlayerContainer) singlePlayerContainer.classList.add('hidden');
            if (statsScreen) statsScreen.classList.add('hidden');
            if (homeBtn) homeBtn.classList.remove('show');
            
            if (window.currentUser) {
                if (authScreen) authScreen.classList.add('hidden');
                if (initialScreen) initialScreen.classList.remove('hidden');
            } else {
                if (initialScreen) initialScreen.classList.add('hidden');
                if (authScreen) authScreen.classList.remove('hidden');
            }
        };

        // TEMA Sƒ∞STEMƒ∞
        let currentTheme = 'theme-void';
        const themes = ['theme-void', 'theme-dark', 'theme-light'];
        
        function switchTheme(themeName) {
            document.body.className = document.body.className.replace(/theme-\w+/g, '');
            document.body.classList.add(themeName);
            currentTheme = themeName;
            localStorage.setItem('selectedTheme', themeName);
        }
        
        function cycleTheme() {
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            switchTheme(themes[nextIndex]);
        }

        // ANASAYFA BUTONU Y√ñNETƒ∞Mƒ∞
        function showHomeButton() {
            const homeBtn = document.getElementById('go-home');
            if (homeBtn) homeBtn.classList.add('show');
        }
        
        function hideHomeButton() {
            const homeBtn = document.getElementById('go-home');
            if (homeBtn) homeBtn.classList.remove('show');
        }
        
        if (window.location.protocol === 'file:') {
            document.body.innerHTML = `<div class="bg-red-900 border border-red-700 text-white p-8 rounded-lg shadow-xl max-w-lg mx-auto"><h1 class="text-3xl font-bold mb-4">Hata: Yanlƒ±≈ü √áalƒ±≈ütƒ±rma Y√∂ntemi</h1><p class="mb-2 text-lg">Bu dosyayƒ± doƒürudan √ßift tƒ±klayarak a√ßtƒ±nƒ±z. Bu oyunun √ßalƒ±≈ümasƒ± i√ßin bir sunucu √ºzerinden a√ßƒ±lmasƒ± gerekir.</p><p class="mt-4">L√ºtfen <strong>node server.js</strong> komutunu √ßalƒ±≈ütƒ±rdƒ±ktan sonra tarayƒ±cƒ±nƒ±zƒ±n adres √ßubuƒüuna ≈üunu yazƒ±n:</p><p class="text-2xl font-mono bg-gray-900 p-3 rounded my-4 text-center select-all">http://localhost:3000</p></div>`;
        } else {
            const authScreen = document.getElementById('auth-screen');
            const entryMessage = document.getElementById('entryMessage');
            const entryUsername = document.getElementById('entryUsername');
            const startGameButton = document.getElementById('startGameButton');
            const entryAvatar = document.getElementById('entry-avatar');
            const initialScreen = document.getElementById('initial-screen');
            const gameContainer = document.getElementById('game-container');
            const singlePlayerContainer = document.getElementById('single-player-container');
            const createRoomButton = document.getElementById('createRoomButton');
            const showJoinFormButton = document.getElementById('showJoinFormButton');
            const showStatsButton = document.getElementById('showStatsButton');
            const editUsernameBtn = document.getElementById('edit-username-btn');
            let currentPlayers = [];
            let selectedEntryAvatar = 1;
            const welcomeUsername = document.getElementById('welcomeUsername');
            const joinOptions = document.getElementById('join-options');
            const joinForm = document.getElementById('join-form');
            const roomInput = document.getElementById('roomInput');
            const joinRoomButton = document.getElementById('joinRoomButton');
            const backToOptionsButton = document.getElementById('backToOptionsButton');
            const roomLinkInputIngame = document.getElementById('roomLinkInput');
            const copyLinkButtonIngame = document.getElementById('copyLinkButton');
            const inviteLinkInGame = document.getElementById('invite-link-ingame');
            const statusText = document.getElementById('status-text');
            const countdownEl = document.getElementById('countdown');
            const startButton = document.getElementById('startButton');
            const newGameButton = document.getElementById('newGameButton');
            const scoreboardDiv = document.getElementById('scoreboard');
            const resetScoreButton = document.getElementById('resetScoreButton');
            const saveSettingsButton = document.getElementById('saveSettingsButton');
            const scoreGoalSelect = document.getElementById('scoreGoalSelect');
            const scoreGoalDisplay = document.getElementById('score-goal-display');
            const hostOptions = document.getElementById('host-options');
            const letterSlotContainer = document.getElementById('letter-slot-container');
            const categorySlotContainer = document.getElementById('category-slot-container');
            const hostDecisionButtons = document.getElementById('host-decision-buttons');
            const addWordYesButton = document.getElementById('addWordYes');
            const addWordNoButton = document.getElementById('addWordNo');
            const wordInputArea = document.getElementById('word-input-area');
            const wordInput = document.getElementById('wordInput');
            const wordForm = document.getElementById('word-form');
            const turnDurationSelect = document.getElementById('turnDurationSelect');
            const turnDurationDisplay = document.getElementById('turn-duration-display');
            const statsScreen = document.getElementById('stats-screen');
            const closeStatsButton = document.getElementById('closeStatsButton');
            
            // TEK BA≈ûINA OYNA √ñZELLƒ∞ƒûƒ∞ KALDIRILDI
            // const spTaskArea = document.getElementById('sp-task-area');
            // const spScoreEl = document.getElementById('sp-score').querySelector('span');
            // ...diƒüer sp elementleri kaldƒ±rƒ±ldƒ±
            
            let synth = null;
            let myDetails = null;
            let currentHostId = null;
            let currentRoomId = null;
            let wordToAddInfo = null;
            let currentUser = null;
            let gameStarted = false;
            window.currentUser = null;
            const socket = io();
            const alphabet = 'ABC√áDEFHIƒ∞JKLMNO√ñPRS≈ûTU√úVYZ'.split('');
            const categories = ['ƒ∞sim', 'Hayvan', 'Bitki/Meyve/Sebze', '√úlke/≈ûehir/ƒ∞l√ße', 'E≈üya', 'Meslek'];
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;
            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.lang = 'tr-TR';
                recognition.continuous = false;
            }
            const showEntryMessage = (message, isError = false) => {
                const entryMessage = document.getElementById('entryMessage');
                entryMessage.textContent = message;
                entryMessage.className = `mt-4 p-3 rounded-lg text-center text-sm ${isError ? 'bg-red-600 text-white' : 'bg-green-600 text-white'}`;
                entryMessage.classList.remove('hidden');
                setTimeout(() => entryMessage.classList.add('hidden'), 3000);
            };
            const validateUsername = (username) => {
                if (!username || username.length < 2) {
                    showEntryMessage('Kullanƒ±cƒ± adƒ± en az 2 karakter olmalƒ±!', true);
                    return false;
                }
                if (username.length > 20) {
                    showEntryMessage('Kullanƒ±cƒ± adƒ± en fazla 20 karakter olabilir!', true);
                    return false;
                }
                if (!/^[a-zA-Z0-9_√ßƒüƒ±√∂≈ü√º√áƒûIƒ∞√ñ≈û√ú\s]+$/.test(username)) {
                    showEntryMessage('Kullanƒ±cƒ± adƒ± sadece harf, rakam ve _ i√ßerebilir!', true);
                    return false;
                }
                return true;
            };
            const showMainMenu = (user) => {
                currentUser = user;
                window.currentUser = user;
                welcomeUsername.textContent = user.username;
                const userAvatar = document.getElementById('user-avatar');
                if (userAvatar) {
                    const avatarData = getAvatarData(user.avatar || 1);
                    userAvatar.className = `avatar small ${avatarData.class}`;
                    userAvatar.textContent = avatarData.emoji;
                }
                authScreen.classList.add('hidden');
                initialScreen.classList.remove('hidden');
                hideHomeButton();
                setupAvatarButton();
                setupUsernameEdit();
            };
            
            const setupUsernameEdit = () => {
                if (editUsernameBtn) {
                    editUsernameBtn.addEventListener('click', () => {
                        const newUsername = prompt('Yeni kullanƒ±cƒ± adƒ±nƒ± girin:', currentUser.username);
                        if (newUsername && newUsername.trim() && validateUsername(newUsername.trim())) {
                            currentUser.username = newUsername.trim();
                            window.currentUser = currentUser;
                            welcomeUsername.textContent = currentUser.username;
                            showEntryMessage(`ƒ∞sim "${currentUser.username}" olarak deƒüi≈ütirildi!`, false);
                        }
                    });
                }
            };
            const setupAvatarButton = () => {
                const chooseAvatarBtn = document.getElementById('choose-avatar-btn');
                const avatarModal = document.getElementById('avatar-modal');
                if (chooseAvatarBtn && avatarModal) {
                    const newBtn = chooseAvatarBtn.cloneNode(true);
                    chooseAvatarBtn.parentNode.replaceChild(newBtn, chooseAvatarBtn);
                    newBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        avatarModal.classList.remove('hidden');
                        const avatarGrid = document.getElementById('avatar-grid');
                        if (avatarGrid && avatarGrid.children.length === 0) {
                            populateAvatarGrid();
                        }
                    });
                }
            };
            const populateAvatarGrid = () => {
                const avatarGrid = document.getElementById('avatar-grid');
                if (!avatarGrid) return;
                avatarGrid.innerHTML = '';
                
                // Determine current avatar - from entry screen or current user
                let currentAvatarId = selectedEntryAvatar;
                if (window.currentUser && window.currentUser.avatar) {
                    currentAvatarId = window.currentUser.avatar;
                }
                
                for (let i = 1; i <= 16; i++) {
                    const avatarOption = document.createElement('div');
                    const avatarData = getAvatarData(i);
                    avatarOption.className = `avatar avatar-option ${avatarData.class}`;
                    avatarOption.textContent = avatarData.emoji;
                    avatarOption.dataset.avatarId = i;
                    
                    // Pre-select current avatar
                    if (i === currentAvatarId) {
                        avatarOption.classList.add('selected');
                        selectedAvatarId = i;
                    }
                    
                    avatarOption.addEventListener('click', () => {
                        document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                        avatarOption.classList.add('selected');
                        selectedAvatarId = i;
                    });
                    avatarGrid.appendChild(avatarOption);
                }
                
                // Fallback if no avatar was pre-selected
                if (!selectedAvatarId && avatarGrid.children[0]) {
                    avatarGrid.children[0].classList.add('selected');
                    selectedAvatarId = 1;
                }
            };
            const returnToMainMenu = () => {
                gameContainer.classList.add('hidden');
                singlePlayerContainer.classList.add('hidden');
                statsScreen.classList.add('hidden');
                if (currentUser) {
                    showMainMenu(currentUser);
                } else {
                    showEntryScreen();
                }
            };
            const showEntryScreen = () => {
                currentUser = null;
                window.currentUser = null;
                initialScreen.classList.add('hidden');
                gameContainer.classList.add('hidden');
                singlePlayerContainer.classList.add('hidden');
                statsScreen.classList.add('hidden');
                authScreen.classList.remove('hidden');
                entryUsername.value = '';
                selectedEntryAvatar = 1;
                updateEntryAvatar();
            };
            const updateEntryAvatar = () => {
                const avatarData = getAvatarData(selectedEntryAvatar);
                entryAvatar.className = `avatar large ${avatarData.class} mx-auto cursor-pointer hover:scale-110 transition-transform border-4 border-indigo-500`;
                entryAvatar.textContent = avatarData.emoji;
            };
            entryAvatar.addEventListener('click', () => {
                const avatarModal = document.getElementById('avatar-modal');
                const avatarGrid = document.getElementById('avatar-grid');
                avatarModal.classList.remove('hidden');
                if (avatarGrid.children.length === 0) {
                    populateAvatarGrid();
                }
                document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                const currentOption = document.querySelector(`[data-avatar-id="${selectedEntryAvatar}"]`);
                if (currentOption) {
                    currentOption.classList.add('selected');
                    selectedAvatarId = selectedEntryAvatar;
                }
            });
            startGameButton.addEventListener('click', () => {
                const username = entryUsername.value.trim();
                if (!validateUsername(username)) return;
                // Ensure selectedEntryAvatar is defined
                if (!selectedEntryAvatar) selectedEntryAvatar = selectedAvatarId || 1;
                currentUser = { username: username, avatar: selectedEntryAvatar };
                // Update main menu avatar element immediately so it persists
                const userAvatar = document.getElementById('user-avatar');
                if (userAvatar) {
                    const avatarData = getAvatarData(currentUser.avatar || 1);
                    userAvatar.className = `avatar small ${avatarData.class}`;
                    userAvatar.textContent = avatarData.emoji;
                }
                 window.currentUser = currentUser;
                 showMainMenu(currentUser);
                 showEntryMessage(`Ho≈ü geldin ${username}!`, false);
             });
            entryUsername.addEventListener('keypress', (e) => { if (e.key === 'Enter') startGameButton.click(); });
            showJoinFormButton.addEventListener('click', () => {
                joinOptions.classList.add('hidden');
                joinForm.classList.remove('hidden');
            });
            backToOptionsButton.addEventListener('click', () => {
                joinForm.classList.add('hidden');
                joinOptions.classList.remove('hidden');
            });
            const validateInputs = () => {
                if (!currentUser || !currentUser.username) {
                    showEntryMessage('Kullanƒ±cƒ± bilgisi bulunamadƒ±. L√ºtfen ana men√ºye d√∂n√ºn.', true);
                    return false;
                }
                return { name: currentUser.username, avatar: currentUser.avatar };
            };
            createRoomButton.addEventListener('click', () => {
                const userData = validateInputs();
                if (userData) {
                    initializeAudio();
                    socket.emit('createRoom', userData);
                }
            });
            joinRoomButton.addEventListener('click', () => {
                const userData = validateInputs();
                const roomId = roomInput.value.trim().toUpperCase();
                if (!roomId) return alert('L√ºtfen bir oda kodu girin.');
                if (userData) {
                    initializeAudio();
                    socket.emit('joinRoom', { ...userData, roomId });
                }
            });

            // TEK BA≈ûINA OYNA √ñZELLƒ∞ƒûƒ∞ KALDIRILDI
            // startSinglePlayerButton.addEventListener('click', () => {
            //     const userData = validateInputs();
            //     if(userData) {
            //         initializeAudio();
            //         socket.emit('startSinglePlayer', userData);
            //     }
            // });
            copyLinkButtonIngame.addEventListener('click', () => {
                roomLinkInputIngame.select();
                document.execCommand('copy');
                copyLinkButtonIngame.textContent = 'Kopyalandƒ±!';
                setTimeout(() => { copyLinkButtonIngame.textContent = 'Kopyala'; }, 1500);
            });
            startButton.addEventListener('click', () => {
                gameStarted = true;
                socket.emit('startDiceRoll');
            });
            newGameButton.addEventListener('click', () => {
                gameStarted = false;
                socket.emit('newGame');
            });
            resetScoreButton.addEventListener('click', () => showResetConfirmation());
            saveSettingsButton.addEventListener('click', () => {
                // Ayarlarƒ± kaydet
                const scoreGoal = scoreGoalSelect.value;
                const turnDuration = turnDurationSelect.value;
                socket.emit('updateSettings', { scoreGoal: parseInt(scoreGoal), turnDuration: parseInt(turnDuration) });
                
                // Ba≈üarƒ± mesajƒ± g√∂ster
                saveSettingsButton.textContent = 'KAYDEDƒ∞LDƒ∞ ‚úì';
                saveSettingsButton.style.backgroundColor = '#059669';
                setTimeout(() => {
                    saveSettingsButton.textContent = 'KAYDET';
                    saveSettingsButton.style.backgroundColor = '#16a34a';
                }, 2000);
            });
            
            function showResetConfirmation() {
                const popup = document.getElementById('reset-confirmation');
                if (popup) {
                    popup.classList.remove('hidden');
                    
                    document.getElementById('confirm-reset').onclick = () => {
                        socket.emit('resetScores');
                        popup.classList.add('hidden');
                    };
                    
                    document.getElementById('cancel-reset').onclick = () => {
                        popup.classList.add('hidden');
                    };
                    
                    popup.querySelector('.popup-overlay').onclick = () => {
                        popup.classList.add('hidden');
                    };
                }
            }
            function sendSettingsUpdate() {
                if (myDetails && myDetails.id === currentHostId && !gameStarted) {
                    socket.emit('gameSettingsChanged', { 
                        scoreGoal: parseInt(scoreGoalSelect.value, 10),
                        turnDuration: parseInt(turnDurationSelect.value, 10)
                    });
                }
            }
            scoreGoalSelect.addEventListener('change', sendSettingsUpdate);
            turnDurationSelect.addEventListener('change', sendSettingsUpdate);
            addWordYesButton.addEventListener('click', () => {
                if(wordToAddInfo) {
                    socket.emit('hostDecisionOnWord', { add: true, wordInfo: wordToAddInfo });
                    hostDecisionButtons.classList.add('hidden');
                }
            });
            addWordNoButton.addEventListener('click', () => {
                if(wordToAddInfo) {
                    socket.emit('hostDecisionOnWord', { add: false, wordInfo: wordToAddInfo });
                    hostDecisionButtons.classList.add('hidden');
                }
            });
            window.addEventListener('load', () => {
                const params = new URLSearchParams(window.location.search);
                const roomIdFromUrl = params.get('oda');
                if (roomIdFromUrl) {
                    roomInput.value = roomIdFromUrl.toUpperCase();
                    showJoinFormButton.click();
                }
            });
            function submitWord(word) {
                if (word && word.trim()) {
                   
                                       socket.emit('submitWord', word.trim());

                    wordInput.value = '';
                    wordInputArea.classList.add('hidden');
                    if (recognition) recognition.stop();
                }
            }
            wordForm.addEventListener('submit', (e) => { e.preventDefault(); submitWord(wordInput.value); });
            // SP FORM KALDIRILDI: spWordForm.addEventListener('submit', (e) => { e.preventDefault(); submitWord(spWordInput.value); spWordInput.value = ''; });
            if(recognition) {
                recognition.onresult = (event) => submitWord(event.results[0][0].transcript);
                recognition.onerror = (event) => console.error('Ses tanƒ±ma hatasƒ±:', event.error);
            }
            socket.on('roomCreated', ({ roomId, playerDetails }) => {
                myDetails = playerDetails;
                currentRoomId = roomId;
                gameStarted = false;
                initialScreen.classList.add('hidden');
                document.getElementById('lobby-screen')?.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                showHomeButton();
                roomLinkInputIngame.value = `${window.location.origin}?oda=${roomId}`;
            });
            socket.on('joined', ({ playerDetails, roomId }) => {
                myDetails = playerDetails;
                currentRoomId = roomId;
                gameStarted = false;
                initialScreen.classList.add('hidden');
                document.getElementById('lobby-screen')?.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                showHomeButton();
            });
            socket.on('lobbyUpdate', ({ players, gameHostId, settings }) => {
                currentHostId = gameHostId;
                currentPlayers = players; 
                updatePlayerSlots(players);
                statusText.textContent = `${players.length} / 8 oyuncu bekleniyor...`;
                countdownEl.textContent = 'S√úRE';
                countdownEl.classList.remove('placeholder');
                countdownEl.classList.add('placeholder');
                updateUsedWords([], false); 
                const turnIndicator = document.getElementById('turn-indicator');
                if(turnIndicator && players.length > 0) {
                    // ƒ∞lk oyuncuyu g√∂ster
                    const firstPlayer = players[0];
                    const firstSlot = document.getElementById(`player-slot-${firstPlayer.id}`);
                    if (firstSlot) {
                        const rect = firstSlot.getBoundingClientRect();
                        const containerRect = document.getElementById('circular-player-container').getBoundingClientRect();
                        const x = rect.left + rect.width/2 - containerRect.left;
                        const y = rect.top + rect.height/2 - containerRect.top;
                        const angle = Math.atan2(y - containerRect.height/2, x - containerRect.width/2) * (180 / Math.PI);
                        turnIndicator.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;
                        turnIndicator.classList.add('visible');
                    }
                } else if(turnIndicator) {
                    turnIndicator.classList.remove('visible', 'winner');
                }
                scoreGoalDisplay.textContent = settings.scoreGoal;
                scoreGoalSelect.value = settings.scoreGoal;
                turnDurationDisplay.textContent = settings.turnDuration;
                turnDurationSelect.value = settings.turnDuration;
                const isHost = myDetails && myDetails.id === gameHostId;
                inviteLinkInGame.classList.toggle('hidden', players.length === 8);
                if (isHost) roomLinkInputIngame.value = `${window.location.origin}?oda=${currentRoomId}`;
                hostOptions.classList.toggle('hidden', !isHost || gameStarted);
                startButton.classList.toggle('hidden', !(isHost && players.length >= 1) || gameStarted);
                newGameButton.classList.add('hidden');
                hostDecisionButtons.classList.add('hidden');
                resetScoreButton.classList.toggle('hidden', !isHost);
                saveSettingsButton.classList.toggle('hidden', !isHost);
                
                // Eƒüer oyun bitmi≈ü ve host ise, ba≈ülat butonunu g√∂ster
                if (!gameStarted && isHost && players.length >= 1) {
                    startButton.classList.remove('hidden');
                }
            });
            function updateTaskDisplay(letter, category) {
                const letterReel = letterSlotContainer.querySelector('.slot-reel');
                const categoryReel = categorySlotContainer.querySelector('.slot-reel');
                letterReel.style.transition = 'none';
                categoryReel.style.transition = 'none';
                const letterIndex = alphabet.indexOf(letter);
                if (letterIndex > -1) letterReel.style.top = `-${letterIndex * 60}px`;
                const categoryIndex = categories.indexOf(category);
                if (categoryIndex > -1) categoryReel.style.top = `-${categoryIndex * 60}px`;
            }
            socket.on('scoreUpdate', ({ scores, isGameOver }) => updateScoreboard(scores, isGameOver, currentPlayers));
            socket.on('usedWordsUpdate', ({ usedWords }) => { updateUsedWords(usedWords, false); updateUsedWords(usedWords, true); });
            socket.on('diceRolling', ({ finalLetterIndex, finalCategoryIndex }) => {
                const turnIndicator = document.getElementById('turn-indicator');
                if(turnIndicator) turnIndicator.classList.remove('winner');
                startButton.classList.add('hidden');
                newGameButton.classList.add('hidden');
                statusText.textContent = 'Zar atƒ±lƒ±yor...';
                populateReel(letterSlotContainer, alphabet, 60);
                populateReel(categorySlotContainer, categories, 60);
                spinReel(letterSlotContainer, alphabet, finalLetterIndex, 60);
                spinReel(categorySlotContainer, categories, finalCategoryIndex, 60);
            });
            socket.on('gameStart', () => {
                statusText.textContent = '';
                document.querySelectorAll('.player-slot-circle').forEach(s => s.classList.remove('eliminated'));
                updateUsedWords([], false);
            });
            socket.on('playerEliminated', ({ loserId, loserName, reason, word }) => {
                 if (synth) synth.triggerAttackRelease("C3", "8n");
                 const playerSlot = document.querySelector(`#player-slot-${loserId}`);
                 if(playerSlot) playerSlot.classList.add('eliminated');
                 statusText.textContent = `${loserName}, "${reason}" nedeniyle elendi. ${word ? `(S√∂ylenen: "${word}")` : ''}`;
                 if (myDetails && myDetails.id === loserId) wordInputArea.classList.add('hidden');
            });
            socket.on('askHostAboutWord', (wordInfo) => {
                wordToAddInfo = wordInfo;
                statusText.textContent = `'${wordInfo.word}' kelimesi DB'ye eklensin mi?`;
                hostDecisionButtons.classList.remove('hidden');
                countdownEl.textContent = '';
            });
            socket.on('turnUpdate', ({ player, timeLeft, activePlayersCount, letter, category }) => {
                updateTaskDisplay(letter, category);
                hostDecisionButtons.classList.add('hidden');
                if (activePlayersCount >= 3 && synth) synth.triggerAttackRelease("G4", "16n");
                statusText.textContent = '';
                countdownEl.textContent = timeLeft;
                countdownEl.classList.remove('animate-pulse-white-to-red');
                document.querySelectorAll('.player-slot-circle').forEach(s => s.classList.remove('active'));
                const activeSlot = document.querySelector(`#player-slot-${player.id}`);
                if(activeSlot) activeSlot.classList.add('active');
                const turnIndicator = document.getElementById('turn-indicator');
                if (activeSlot && turnIndicator) {
                    const sortedPlayers = [...currentPlayers].sort((a, b) => a.playerNumber - b.playerNumber);
                    const playerIndex = sortedPlayers.findIndex(p => p.id === player.id);
                    const numPlayers = sortedPlayers.length;
                    if(playerIndex !== -1) {
                        let angle;
                        if (numPlayers === 1) { angle = -90; } 
                        else if (numPlayers === 2) { angle = (playerIndex === 0) ? 180 : 0; }
                        else if (numPlayers === 3) { angle = -90 + (playerIndex * 120); }
                        else { angle = -90 + (playerIndex * (360 / numPlayers)); }
                        turnIndicator.style.transform = `rotate(${angle}deg)`;
                        turnIndicator.classList.add('visible');
                    }
                } else if (turnIndicator) {
                    turnIndicator.classList.remove('visible');
                }
                const isMyTurn = myDetails && myDetails.id === player.id;
                wordInputArea.classList.toggle('hidden', !isMyTurn);
                if (isMyTurn) {
                    wordInput.focus();
                    if (recognition) {
                        try { recognition.start(); } 
                        catch(e) { console.error("Ses tanƒ±ma ba≈ülatƒ±lamadƒ±!", e); }
                    }
                } else {
                     if (recognition) recognition.stop();
                }
            });
            socket.on('countdown', (timeLeft) => {
                countdownEl.textContent = timeLeft >= 0 ? timeLeft : 0;
                if (timeLeft === 0) countdownEl.classList.add('animate-pulse-white-to-red');
            });
            socket.on('wordAccepted', ({ playerId }) => {
                if (synth) synth.triggerAttackRelease("C5", "8n");
                const correctSlot = document.querySelector(`#player-slot-${playerId}`);
                if (correctSlot) {
                    correctSlot.classList.add('round-winner');
                    setTimeout(() => correctSlot.classList.remove('round-winner'), 1500);
                }
            });
            socket.on('roundOver', ({ reason, winner }) => {
                wordInputArea.classList.add('hidden');
                hostDecisionButtons.classList.add('hidden');
                const turnIndicator = document.getElementById('turn-indicator');
                if (turnIndicator) {
                    turnIndicator.classList.remove('visible', 'winner');
                    if (winner) {
                        const winnerPlayer = currentPlayers.find(p => p.name === winner);
                        if(winnerPlayer) {
                             const sortedPlayers = [...currentPlayers].sort((a, b) => a.playerNumber - b.playerNumber);
                             const playerIndex = sortedPlayers.findIndex(p => p.id === winnerPlayer.id);
                             const numPlayers = sortedPlayers.length;
                             if(playerIndex !== -1) {
                                let angle;
                                if (numPlayers === 1) { angle = -90; } 
                                else if (numPlayers === 2) { angle = (playerIndex === 0) ? 180 : 0; }
                                else if (numPlayers === 3) { angle = -90 + (playerIndex * 120); }
                                else { angle = -90 + (playerIndex * (360 / numPlayers)); }
                                turnIndicator.style.transform = `rotate(${angle}deg)`;
                                turnIndicator.classList.add('visible', 'winner');
                                const winnerSlot = document.querySelector(`#player-slot-${winnerPlayer.id}`);
                                if (winnerSlot) winnerSlot.classList.add('round-winner');
                             }
                        }
                    }
                }
                if (winner && synth) {
                    const now = Tone.now();
                    synth.triggerAttackRelease("C5", "16n", now);
                    synth.triggerAttackRelease("E5", "16n", now + 0.1);
                    synth.triggerAttackRelease("G5", "8n", now + 0.2);
                } else if (synth) {
                    synth.triggerAttackRelease("E3", "8n");
                }
                if (recognition) recognition.stop();
                statusText.textContent = winner ? `${reason} | Turun galibi: ${winner}` : reason;
                countdownEl.textContent = '';
                document.querySelectorAll('.player-slot-circle').forEach(s => s.classList.remove('active', 'eliminated'));
                const isHost = myDetails && myDetails.id === currentHostId;
                gameStarted = false; // Oyun durumunu sƒ±fƒ±rla
                startButton.classList.toggle('hidden', !isHost);
                newGameButton.classList.add('hidden'); // Yeni oyun butonunu gizle
            });
            socket.on('finalWinner', ({winner, scores}) => {
                wordInputArea.classList.add('hidden');
                if (recognition) recognition.stop();
                updateScoreboard(scores, true, currentPlayers);
                countdownEl.textContent = '';
                statusText.innerHTML = `<div class="text-3xl">üèÜ Oyun Bitti! Kazanan: <span class="gold font-black p-2 rounded-md">${winner}</span> üèÜ</div>`;
                const isHost = myDetails && myDetails.id === currentHostId;
                newGameButton.classList.toggle('hidden', !isHost);
                startButton.classList.add('hidden');
                hostDecisionButtons.classList.add('hidden');
                gameStarted = false;
            });

            // TEK BA≈ûINA OYNA EVENT'LERƒ∞ KALDIRILDI
            /*
            socket.on('singlePlayerStarted', () => {
                initialScreen.classList.add('hidden');
                gameContainer.classList.add('hidden');
                singlePlayerContainer.classList.remove('hidden');
                showHomeButton();
                spGameOverScreen.classList.add('hidden');
                spWordInputArea.classList.remove('hidden');
                spTaskArea.classList.remove('hidden');
                updateUsedWords([], true);
            });
            */
            socket.on('gameError', (message) => alert(message));
            socket.on('dbUpdateSuccess', (message) => {
                statusText.textContent = message;
                setTimeout(() => statusText.textContent = '', 2000);
            });
            socket.on('dbUpdateError', (message) => alert(message));
            function initializeAudio() {
                if(synth) return;
                if (Tone.context.state !== 'running') Tone.context.resume();
                synth = new Tone.Synth().toDestination();
            }
            function populateReel(reelContainer, items, itemHeight) {
                const reel = reelContainer.querySelector('.slot-reel');
                reel.innerHTML = '';
                const itemContainer = document.createElement('div');
                for (let i = 0; i < 5; i++) {
                    items.forEach(item => {
                        const div = document.createElement('div');
                        div.className = `slot-item`;
                        div.style.height = `${itemHeight}px`;
                        div.textContent = item;
                        itemContainer.appendChild(div);
                    });
                }
                reel.appendChild(itemContainer);
            }
            function spinReel(reelContainer, items, finalIndex, itemHeight) {
                const reel = reelContainer.querySelector('.slot-reel');
                const singleSetHeight = items.length * itemHeight;
                reel.style.transition = 'none';
                reel.style.top = `0px`;
                reel.offsetHeight;
                const finalPosition = (4 * singleSetHeight) + (finalIndex * itemHeight);
                reel.style.transition = 'top 2.5s cubic-bezier(0.25, 1, 0.5, 1)';
                reel.style.top = `-${finalPosition}px`;
            }
            function updatePlayerSlots(players = []) {
                const container = document.getElementById('circular-player-container');
                if (!container) return;
                container.innerHTML = ''; 
                const numPlayers = players.length;
                const slotsToRender = numPlayers > 0 ? players : Array(8).fill(null);
                slotsToRender.sort((a, b) => {
                    if (a && b) return a.playerNumber - b.playerNumber;
                    if (a) return -1;
                    if (b) return 1;
                    return 0;
                });
                slotsToRender.forEach((player, index) => {
                    const slot = document.createElement('div');
                    const floatDelay = `-${(Math.random() * 5).toFixed(2)}s`;

                    if (player) {
                        slot.className = 'player-slot-circle';
                        slot.id = `player-slot-${player.id}`;
                        slot.setAttribute('data-avatar', player.avatar || 1);
                        const avatarData = getAvatarData(player.avatar || 1);
                        slot.innerHTML = `
                           <div class="bubble-content animate-float" style="animation-delay: ${floatDelay};">
                                <div class="avatar small ${avatarData.class}">
                                    ${avatarData.emoji}
                                </div>
                                <div class="font-bold text-sm text-center break-all">${player.name}</div>
                           </div>
                        `;
                        slot.addEventListener('mouseenter', () => {
                            slot.classList.add('is-hovering');
                            const bubbleContent = slot.querySelector('.bubble-content');
                            if (bubbleContent) bubbleContent.classList.remove('animate-float');
                        });
                        slot.addEventListener('mouseleave', () => {
                           slot.classList.remove('is-hovering');
                           slot.style.setProperty('--push-x', '0px');
                           slot.style.setProperty('--push-y', '0px');
                           const bubbleContent = slot.querySelector('.bubble-content');
                           if (bubbleContent) {
                               setTimeout(() => bubbleContent.classList.add('animate-float'), 100);
                           }
                        });
                        slot.addEventListener('mousemove', (e) => {
                            const rect = slot.getBoundingClientRect();
                            const centerX = rect.left + rect.width / 2;
                            const centerY = rect.top + rect.height / 2;
                            const deltaX = e.clientX - centerX;
                            const deltaY = e.clientY - centerY;
                            const distance = Math.sqrt(deltaX*deltaX + deltaY*deltaY);
                            if (distance === 0) return;
                            const maxPush = 12;
                            const pushX = (-deltaX / distance) * maxPush;
                            const pushY = (-deltaY / distance) * maxPush;
                            slot.style.setProperty('--push-x', `${pushX}px`);
                            slot.style.setProperty('--push-y', `${pushY}px`);
                        });
                    } else {
                        slot.className = 'player-slot-circle';
                        slot.setAttribute('data-avatar', '0'); // Bo≈ü slot i√ßin default
                        slot.innerHTML = `<div class="bubble-content"><div class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center mb-1 opacity-50"><span class="text-gray-400">?</span></div><div class="text-gray-500 text-sm">Bo≈ü</div></div>`;
                        slot.style.zIndex = -1;
                    }
                    positionElement(slot, index, numPlayers > 0 ? numPlayers : 8, 42, !!player);
                    container.appendChild(slot);
                });
            }
            function positionElement(element, index, total, radiusPercent, isPlayer) {
                let angle;
                if (!isPlayer && total > 0) {
                     angle = -90 + (index * (360 / total));
                } else {
                    if (total === 1) { angle = -90; } 
                    else if (total === 2) { angle = (index === 0) ? 180 : 0; }
                    else if (total === 3) { angle = -90 + (index * 120); }
                    else { angle = -90 + (index * (360 / total)); }
                }
                const angleRad = angle * (Math.PI / 180);
                const x = 50 + (radiusPercent * 0.8) * Math.cos(angleRad); // Radius'u %80'e d√º≈ü√ºr
                const y = 50 + (radiusPercent * 0.8) * Math.sin(angleRad);
                element.style.left = `${x}%`;
                element.style.top = `${y}%`;
            }
            function updateScoreboard(scores = {}, isGameOver = false, players = []) {
                if (!scoreboardDiv) return;
                scoreboardDiv.innerHTML = '';
                const sortedScores = Object.entries(scores).sort(([,a],[,b]) => b-a);
                if (sortedScores.length === 0) {
                    scoreboardDiv.innerHTML = '<p class="text-gray-500 text-center">Hen√ºz puan yok.</p>';
                } else {
                    sortedScores.forEach(([name, score], index) => {
                        const rank = index + 1;
                        let rankClass = '';
                        if (isGameOver) {
                            if (rank === 1) rankClass = 'gold';
                            else if (rank === 2) rankClass = 'silver';
                            else if (rank === 3) rankClass = 'bronze';
                        }
                        const player = players.find(p => p && p.name === name);
                        const avatarId = player?.avatar || 1;
                        const avatarData = getAvatarData(avatarId);
                        const scoreEntry = document.createElement('div');
                        scoreEntry.className = `flex justify-between items-center p-2 rounded-md border-2 border-transparent bg-gray-700 ${rankClass}`;
                        scoreEntry.innerHTML = `<div class="flex items-center gap-2"><span class="font-bold text-lg w-6 text-center">${rank}.</span><div class="avatar small ${avatarData.class}" style="margin-bottom: 0; width: 30px; height: 30px; font-size: 14px;">${avatarData.emoji}</div><span class="font-semibold">${name || 'Bilinmeyen'}</span></div><span class="font-bold text-xl">${score}</span>`;
                        scoreboardDiv.appendChild(scoreEntry);
                    });
                }
            }
            function updateUsedWords(usedWords = [], isSinglePlayer = false) {
                const wordsList = isSinglePlayer ? document.getElementById('sp-used-words-list') : document.getElementById('used-words-list');
                if (!wordsList) return;
                if (usedWords.length === 0) {
                    wordsList.innerHTML = `<p class="text-gray-500 text-sm text-center">Hen√ºz kelime girilmedi</p>`;
                } else {
                    wordsList.innerHTML = '';
                    usedWords.forEach((word, index) => {
                        const wordElement = document.createElement('div');
                        wordElement.className = 'flex justify-between items-center py-1 px-2 mb-1 bg-gray-800 rounded text-sm';
                        wordElement.innerHTML = `<span class="text-white font-medium">${word}</span><span class="text-green-400 text-xs">#${index + 1}</span>`;
                        wordsList.appendChild(wordElement);
                    });
                    wordsList.scrollTop = wordsList.scrollHeight;
                }
            }
            function updatePlayerStatsDisplay(stats) {
                document.getElementById('stat-games-played').textContent = stats.gamesPlayed;
                document.getElementById('stat-games-won').textContent = stats.gamesWon;
                document.getElementById('stat-win-rate').textContent = stats.winRate;
                document.getElementById('stat-longest-streak').textContent = stats.longestWinStreak;
                document.getElementById('stat-current-streak').textContent = stats.currentWinStreak;
                document.getElementById('stat-total-words').textContent = stats.totalCorrectWords;
                document.getElementById('stat-avg-time').textContent = stats.avgResponseTime.toFixed(2);
                document.getElementById('stat-fav-category').textContent = stats.favoriteCategory;
                
                const lastPlayed = new Date(stats.lastPlayed);
                document.getElementById('stat-last-played').textContent = lastPlayed.toLocaleDateString('tr-TR');
                
                const mostUsedContainer = document.getElementById('most-used-words');
                if (stats.mostUsedWords.length === 0) {
                    mostUsedContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">Hen√ºz kelime verisi yok</p>';
                } else {
                    mostUsedContainer.innerHTML = '';
                    stats.mostUsedWords.forEach(({ word, count }) => {
                        const wordElement = document.createElement('div');
                        wordElement.className = 'themed-bg-secondary p-3 rounded-lg text-center';
                        wordElement.innerHTML = `<div class="font-bold themed-text">${word}</div><div class="text-sm themed-text-muted">${count} kez</div>`;
                        mostUsedContainer.appendChild(wordElement);
                    });
                }
            }
            closeStatsButton.addEventListener('click', () => { 
                statsScreen.classList.add('hidden'); 
                initialScreen.classList.remove('hidden'); 
                hideHomeButton();
            });
            showStatsButton.addEventListener('click', () => {
                if (!currentUser) return showEntryMessage('ƒ∞statistikleri g√∂rmek i√ßin oyuna giri≈ü yapƒ±n!', true);
                socket.emit('requestPlayerStats', { playerName: currentUser.username });
                initialScreen.classList.add('hidden');
                statsScreen.classList.remove('hidden');
                showHomeButton();
            });
            socket.on('playerStatsUpdate', ({ stats }) => updatePlayerStatsDisplay(stats));
            window.addEventListener('load', showEntryScreen);
        }
        
        const avatarEmojis = ['üéÆ', 'üöÄ', '‚≠ê', 'üåü', 'üéØ', 'üé≤', 'üèÜ', 'üíé', 'üî•', '‚ö°', 'üé™', 'üé≠', 'üé®', 'üéµ', 'üåà', 'üí´'];
        let selectedAvatarId = 1;
        let avatarSystemInitialized = false;
        
        function getAvatarData(avatarId) {
            return { emoji: avatarEmojis[avatarId - 1] || 'üéÆ', class: `avatar-${avatarId}` };
        }
        function initializeAvatarSystem() {
            if (avatarSystemInitialized) return; 
            const avatarModal = document.getElementById('avatar-modal');
            const chooseAvatarBtn = document.getElementById('choose-avatar-btn');
            const avatarConfirm = document.getElementById('avatar-confirm');
            const avatarCancel = document.getElementById('avatar-cancel');
            const userAvatar = document.getElementById('user-avatar');
            if (!avatarModal || !chooseAvatarBtn || !avatarConfirm || !avatarCancel || !userAvatar) return;
            avatarSystemInitialized = true;
            chooseAvatarBtn.addEventListener('click', (e) => { e.preventDefault(); avatarModal.classList.remove('hidden'); });
            avatarCancel.addEventListener('click', () => avatarModal.classList.add('hidden'));
            avatarConfirm.addEventListener('click', () => {
                const avatarData = getAvatarData(selectedAvatarId);
                const entryAvatarEl = document.getElementById('entry-avatar');
                const authScreenEl = document.getElementById('auth-screen');
                const avatarModal = document.getElementById('avatar-modal');
                
                // If auth screen is visible, update entry-avatar selection
                if (authScreenEl && !authScreenEl.classList.contains('hidden') && entryAvatarEl) {
                    selectedEntryAvatar = selectedAvatarId;
                    entryAvatarEl.className = `avatar large ${avatarData.class} mx-auto cursor-pointer hover:scale-110 transition-transform border-4 border-indigo-500`;
                    entryAvatarEl.textContent = avatarData.emoji;
                } else if (userAvatar) {
                    // Otherwise update the user-avatar in the main menu and notify server
                    userAvatar.className = `avatar small ${avatarData.class}`;
                    userAvatar.textContent = avatarData.emoji;
                    if (window.currentUser) {
                        window.currentUser.avatar = selectedAvatarId;
                        socket.emit('changeAvatar', { avatar: selectedAvatarId });
                    }
                }
                avatarModal.classList.add('hidden');
            });
            avatarModal.addEventListener('click', (e) => { if (e.target === avatarModal) avatarModal.classList.add('hidden'); });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeAvatarSystem();
            const fixedControls = document.getElementById('bg-controls-fixed');
            if (fixedControls) fixedControls.classList.remove('hidden');
            
            const toggleHowtoBtn = document.getElementById('toggle-howto');
            const howtoPanel = document.getElementById('howto-panel');
            const closeHowto = document.getElementById('close-howto');
            if (toggleHowtoBtn && howtoPanel) {
                toggleHowtoBtn.addEventListener('click', () => {
                    const isHidden = howtoPanel.classList.contains('hidden');
                    howtoPanel.classList.toggle('hidden', !isHidden);
                });
            }
            if (closeHowto && howtoPanel) closeHowto.addEventListener('click', () => howtoPanel.classList.add('hidden'));
            
            // Tema sistemi ba≈ülatma
            const savedTheme = localStorage.getItem('selectedTheme') || 'dark';
            changeTheme(savedTheme);
        });

        function changeTheme(theme) {
            const body = document.body;
            const themeBtns = document.querySelectorAll('.theme-btn');
            
            // Remove all theme classes
            body.classList.remove('theme-void', 'theme-dark', 'theme-light');
            
            // Add new theme class
            body.classList.add(`theme-${theme}`);
            
            // Update active button
            themeBtns.forEach(btn => btn.classList.remove('active'));
            const targetBtn = document.querySelector(`.theme-btn-${theme}`);
            if (targetBtn) targetBtn.classList.add('active');
            
            // Update animated background
            const animatedBg = document.getElementById('animated-background');
            if (animatedBg) {
                animatedBg.className = 'animated-bg';
            }
            
            localStorage.setItem('selectedTheme', theme);
        }
    </script>
</body>
</html>